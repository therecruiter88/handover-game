<html>
<head>
  <title>The Pineapple Pizza Invasion</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #f9c0c0;
      margin: 0;
      overflow: hidden;
      color: white;
    }

    #game-container {
      width: 600px;
      height: 400px;
      background-color: #222;
      border: 1px solid #ff0000;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.6);
      display: none;
    }

    #player {
      width: 60px;
      height: 80px;
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-30px);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #score-display {
      position: absolute;
      top: 10px;
      right: 10px;
      color: #ffccd5;
      font-size: 24px;
      font-weight: bold;
    }
    
    #timer-display {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }
    
    .bullet {
      width: 5px;
      height: 15px;
      background-color: yellow;
      position: absolute;
      border-radius: 2px;
    }

    .target {
      width: 40px;
      height: 40px;
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    #intro-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    
    #intro-logo {
      width: 80%;
      max-width: 800px;
      text-align: center;
      color: #EB257A;
      font-size: 3rem;
      font-weight: bold;
      letter-spacing: 0.2rem;
      font-family: 'Press Start 2P', cursive;
      position: relative;
      opacity: 0;
      animation: logoReveal 4s ease-in-out forwards;
    }
    
    @keyframes logoReveal {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.1); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    #intro-logo::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 0;
      width: 0%;
      height: 5px;
      background-color: #EB257A;
      animation: lineGrow 2s ease-in-out 2s forwards;
    }
    
    @keyframes lineGrow {
      0% { width: 0%; }
      100% { width: 100%; }
    }
    
    /* Instructions popup */
    #instructions-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      text-align: center;
      z-index: 90;
      display: none;
      border: 2px solid #E50914;
    }
    
    #instructions-popup h2 {
      color: #EB257A;
      margin-top: 0;
    }
    
    #instructions-popup button {
      background-color: #EB257A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 1rem;
      margin-top: 20px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
    }
    
    #instructions-popup p {
      text-align: center;
    }
    
    /* Player selector */
    #player-selector {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      text-align: center;
      z-index: 80;
      display: none;
      border: 2px solid #EB257A;
    }
    
    #player-selector h2 {
      color: #EB257A;
      margin-top: 0;
    }
    
    .player-options {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }
    
    .player-option {
      cursor: pointer;
      padding: 10px;
      border-radius: 5px;
      transition: all 0.3s;
    }
    
    .player-option:hover, .player-option.selected {
      background-color: rgba(235, 37, 122, 0.5);
    }
    
    #player-selector button {
      background-color: #EB257A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 1rem;
      margin-top: 20px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
      opacity: 0.5;
      pointer-events: none;
    }
    
    #player-selector button.enabled {
      opacity: 1;
      pointer-events: auto;
    }
    
    /* Story intro container */
    #story-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #f9c0c0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 95;
      font-family: 'Press Start 2P', cursive;
      color: white;
      display: none;
    }
    
    #story-box {
      text-align: center;
      background-color: rgba(0, 0, 0, 0.9);
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      border: 2px solid #E50914;
      width: 500px;
      position: relative;
      height: 320px;
    }
    
    #story-title {
      color: #EB257A;
      margin-top: 0;
      margin-bottom: 20px;
    }
    
    #story-text {
      max-width: 100%;
      font-size: 15px;
      line-height: 1.6;
      text-align: justify;
      height: 200px;
      overflow: hidden;
    }
    
    #story-text p {
      margin-bottom: 1.5em;
    }
    
    #continue-btn {
      background-color: #EB257A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 0.8rem;
      margin-top: 20px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
      display: none;
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
    }
    
    /* Celebration animation */
    #celebration {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 50;
    }
    
    #celebration h2 {
      color: gold;
      font-size: 1.2rem;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
      animation: pulse 1s infinite alternate;
      max-width: 80%;
      text-align: center;
      margin: 0 auto 20px auto;
    }
    
    #celebration p {
      color: gold;
      font-size: 1rem;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
      max-width: 80%;
      text-align: center;
    }
    
    /* Game over animation */
    #game-over {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 50;
    }
    
    #game-over h2 {
      color: red;
      font-size: 1.2rem;
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      animation: pulse 1s infinite alternate;
      max-width: 80%;
      text-align: center;
      margin: 0 auto 20px auto;
    }
    
    #game-over p {
      color: red;
      font-size: 1rem;
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
      max-width: 80%;
      text-align: center;
    }
    
    /* X animation for elimination */
    #elimination-x {
      margin-top: 15px;
      font-size: 60px;
      color: red;
      transform: scale(0);
      animation: growX 1s forwards 0.5s;
    }
    
    @keyframes growX {
      0% { transform: scale(0) rotate(0deg); }
      80% { transform: scale(1.2) rotate(10deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    /* Retry button for game over */
    #retry-button {
      background-color: #EB257A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 0.8rem;
      margin-top: 20px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
    }
    
    /* Game completion popup */
    #game-completion {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      text-align: center;
      z-index: 100;
      display: none;
      border: 2px solid #EB257A;
    }
    
    #game-completion h2 {
      color: #EB257A;
      margin-top: 0;
    }
    
    #game-completion p {
      margin-bottom: 20px;
    }
    
    #game-completion button {
      background-color: #EB257A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 0.8rem;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
    }
    
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f00;
      opacity: 0.8;
      animation: fall 5s linear forwards;
    }
    
    @keyframes fall {
      0% { transform: translateY(-100px) rotate(0deg); }
      100% { transform: translateY(400px) rotate(360deg); }
    }
    
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.1); }
    }
    
    /* Hit effect styling */
    .hit-effect {
      position: absolute;
      width: 40px;
      height: 40px;
      background-color: yellow;
      border-radius: 50%;
      opacity: 0.7;
      animation: hitFade 0.3s forwards;
    }
    
    @keyframes hitFade {
      0% { transform: scale(0.5); opacity: 0.7; }
      100% { transform: scale(1.5); opacity: 0; }
    }
  </style>
</head>
<body>
  <!-- Netflix-style intro -->
  <div id="intro-container">
    <div id="intro-logo">THE PINEAPPLE PIZZA INVASION</div>
  </div>
  
  <!-- Story container -->
  <div id="story-container">
    <div id="story-box">
      <h2 id="story-title">Backstory</h2>
      <div id="story-text"></div>
      <button id="continue-btn">Continue</button>
    </div>
  </div>
  
  <!-- Instructions popup -->
  <div id="instructions-popup">
    <h2>How to Play</h2>
    <p>Use arrow keys to move the Squid Game soldier left and right.</p>
    <p>Press SPACE to shoot at the pineapple pizzas.</p>
    <p>Each hit earns you 10 points!</p>
    <p>You have 30 seconds to reach 500 points or you'll be ELIMINATED!</p>
    <button id="instructions-close">Got it!</button>
  </div>
  
  <!-- Player selector -->
  <div id="player-selector">
    <h2>Choose Your Player</h2>
    <div class="player-options">
      <div class="player-option" data-shape="circle">
        <svg width="60" height="80" viewBox="0 0 60 80">
          <!-- Circle player -->
          <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
          <circle cx="30" cy="20" r="10" fill="black" />
          <circle cx="30" cy="20" r="5" fill="white" />
          <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
          <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
        </svg>
      </div>
      <div class="player-option" data-shape="square">
        <svg width="60" height="80" viewBox="0 0 60 80">
          <!-- Square player -->
          <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
          <circle cx="30" cy="20" r="10" fill="black" />
          <rect x="25" y="15" width="10" height="10" fill="white" />
          <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
          <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
        </svg>
      </div>
      <div class="player-option" data-shape="triangle">
        <svg width="60" height="80" viewBox="0 0 60 80">
          <!-- Triangle player -->
          <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
          <circle cx="30" cy="20" r="10" fill="black" />
          <polygon points="30,15 25,25 35,25" fill="white" />
          <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
          <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
        </svg>
      </div>
    </div>
    <button id="start-game" disabled>Start Game</button>
  </div>
  
  <div id="game-container">
    <div id="player">
      <svg width="60" height="80" viewBox="0 0 60 80">
        <!-- Squid Game Soldier -->
        <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
        <circle cx="30" cy="20" r="10" fill="black" />
        <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
        <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
      </svg>
    </div>
    <div id="score-display">Score: 0</div>
    <div id="timer-display">Time: 30</div>
    
    <!-- Celebration container -->
    <div id="celebration">
      <h2>Congratulations!</h2>
      <p>You have saved the planet from all of the pineapple pizzas!</p>
    </div>
    
    <!-- Game over container -->
    <div id="game-over">
      <h2>ELIMINATED!</h2>
      <p>The pineapple pizzas destroyed the planet and you were not able to save PEMP!</p>
      <div id="elimination-x">X</div>
      <button id="retry-button">Retry</button>
    </div>
  </div>

  <!-- Game completion popup -->
  <div id="game-completion">
    <h2>Next Game Unlocked!</h2>
    <p>You have successfully completed this challenge and unlocked the next game!</p>
    <div class="buttons">
      <button id="home-button">Return to Base</button>
      <button id="next-game-button">Next Game</button>
    </div>
  </div>

  <!-- Audio elements for game sounds -->
  <audio id="countdown-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/212/212-preview.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="countdown-fast-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/212/212-preview.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="laser-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/202/202-preview.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="elimination-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/218/218-preview.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="victory-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/943/943-preview.mp3" type="audio/mpeg">
  </audio>

  <audio id="game-start-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2020/2020-preview.mp3" type="audio/mpeg">
  </audio>
  
  <audio id="intro-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" type="audio/mpeg">
  </audio>

  <audio id="squid-game-sound" preload="auto">
    <source src="https://assets.soundbible.com/mp3/dark-music-loop-40818.mp3" type="audio/mpeg">
  </audio>

  <audio id="typing-sound" preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2363/2363-preview.mp3" type="audio/mpeg">
  </audio>

  <script>
    const gameContainer = document.getElementById('game-container');
    const player = document.getElementById('player');
    const scoreDisplay = document.getElementById('score-display');
    const timerDisplay = document.getElementById('timer-display');
    const introContainer = document.getElementById('intro-container');
    const instructionsPopup = document.getElementById('instructions-popup');
    const instructionsClose = document.getElementById('instructions-close');
    const playerSelector = document.getElementById('player-selector');
    const startGameBtn = document.getElementById('start-game');
    const playerOptions = document.querySelectorAll('.player-option');
    const celebration = document.getElementById('celebration');
    const gameOver = document.getElementById('game-over');
    const gameCompletion = document.getElementById('game-completion');
    const homeButton = document.getElementById('home-button');
    const nextGameButton = document.getElementById('next-game-button');
    const retryButton = document.getElementById('retry-button');

    const storyContainer = document.getElementById('story-container');
    const storyText = document.getElementById('story-text');
    const continueBtn = document.getElementById('continue-btn');
    const typingSound = document.getElementById('typing-sound');
    
    // Sound elements
    const countdownSound = document.getElementById('countdown-sound');
    const countdownFastSound = document.getElementById('countdown-fast-sound');
    const eliminationSound = document.getElementById('elimination-sound');
    const victorySound = document.getElementById('victory-sound');
    const gameStartSound = document.getElementById('game-start-sound');
    const introSound = document.getElementById('intro-sound');
    const squidGameSound = document.getElementById('squid-game-sound');
    const laserSound = document.getElementById('laser-sound');

    // Game variables
    let playerPosition = 270;
    let bullets = [];
    let targets = [];
    let score = 0;
    let gameTime = 30;
    let gameInterval;
    let timerInterval;
    let isGameOver = false;
    let targetGenerationInterval;

    // Story text
    const storylineText = [
      "Tomorrow was meant to be a simple farewell pizza party for António Silva. But something went horribly wrong. Dark forces have unleashed an unstoppable plague of pineapple pizzas, threatening to take over the planet.",
      "What was once a celebration has become a mission, a battle for survival. To save António's farewell and stop the invasion, you must destroy every last slice before it's too late!"
    ];
  
    const storyTitles = ["Storyline", "Challenge"];
  
    // Intro sequence and game initialization
    setTimeout(() => {
      introSound.volume = 0.5;
      introSound.play();
    }, 500);
    
    setTimeout(() => {
      introContainer.style.display = 'none';
      storyContainer.style.display = 'flex';
      document.getElementById('story-title').textContent = storyTitles[0];
      
      // Stop intro sound and start typing sound at a low volume
      introSound.pause();
      typingSound.volume = 0.2;
      typingSound.loop = true;
      
      // Type out the storyline text
      let storyStep = 0;
      let charIndex = 0;
      let currentParagraph = document.createElement('p');
      storyText.innerHTML = ''; // Clear any existing content
      storyText.appendChild(currentParagraph);
      
      // Don't play typing sound during storyline
      // typingSound.play();
      
      const typingInterval = setInterval(() => {
        if (charIndex < storylineText[storyStep].length) {
          currentParagraph.textContent += storylineText[storyStep][charIndex];
          charIndex++;
        } else {
          // Text complete, show continue button
          clearInterval(typingInterval);
          // typingSound.pause();
          continueBtn.style.display = 'block';
        }
      }, 50);
      
      continueBtn.addEventListener('click', () => {
        storyStep++;
        
        if (storyStep < storylineText.length) {
          // Move to next story step
          document.getElementById('story-title').textContent = storyTitles[storyStep];
          storyText.innerHTML = '';
          currentParagraph = document.createElement('p');
          storyText.appendChild(currentParagraph);
          charIndex = 0;
          continueBtn.style.display = 'none';
          
          // typingSound.currentTime = 0;
          // typingSound.play();
          
          const nextTypingInterval = setInterval(() => {
            if (charIndex < storylineText[storyStep].length) {
              currentParagraph.textContent += storylineText[storyStep][charIndex];
              charIndex++;
            } else {
              // Text complete, show continue button
              clearInterval(nextTypingInterval);
              // typingSound.pause();
              continueBtn.style.display = 'block';
            }
          }, 50);
        } else {
          // Move to instructions
          storyContainer.style.display = 'none';
          instructionsPopup.style.display = 'block';
          
          // Play squid game sound when instructions appear
          squidGameSound.volume = 0.5;
          squidGameSound.play();
        }
      });
    }, 4500); // Show story after intro animation
    
    instructionsClose.addEventListener('click', () => {
      instructionsPopup.style.display = 'none';
      playerSelector.style.display = 'block';
      
      const fadeAudio = setInterval(() => {
        if (squidGameSound.volume > 0.1) {
          squidGameSound.volume -= 0.1;
        } else {
          squidGameSound.pause();
          squidGameSound.volume = 0.5;
          clearInterval(fadeAudio);
        }
      }, 200);
    });
    
    // Add player selection functionality
    let selectedShape = null;
    
    playerOptions.forEach(option => {
      option.addEventListener('click', () => {
        // Remove selected class from all options
        playerOptions.forEach(opt => opt.classList.remove('selected'));
        
        // Add selected class to clicked option
        option.classList.add('selected');
        
        // Store selected shape
        selectedShape = option.getAttribute('data-shape');
        
        // Enable start button
        startGameBtn.classList.add('enabled');
        startGameBtn.disabled = false;
      });
    });
    
    startGameBtn.addEventListener('click', () => {
      if (selectedShape) {
        // Set player shape based on selection
        const playerSvg = player.querySelector('svg');
        
        if (selectedShape === 'circle') {
          playerSvg.innerHTML = `
            <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
            <circle cx="30" cy="20" r="10" fill="black" />
            <circle cx="30" cy="20" r="5" fill="white" />
            <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
            <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
          `;
        } else if (selectedShape === 'square') {
          playerSvg.innerHTML = `
            <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
            <circle cx="30" cy="20" r="10" fill="black" />
            <rect x="25" y="15" width="10" height="10" fill="white" />
            <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
            <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
          `;
        } else if (selectedShape === 'triangle') {
          playerSvg.innerHTML = `
            <rect x="15" y="10" width="30" height="40" fill="#ff0066" />
            <circle cx="30" cy="20" r="10" fill="black" />
            <polygon points="30,15 25,25 35,25" fill="white" />
            <rect x="18" y="50" width="24" height="25" fill="#ff0066" />
            <rect x="10" y="40" width="40" height="10" fill="#ff0066" />
          `;
        }
        
        // Hide player selector and show game
        playerSelector.style.display = 'none';
        gameContainer.style.display = 'block';
        
        // Start the game
        gameStartSound.play();
        startGame();
      }
    });
    
    function startGame() {
      // Initialize game state
      score = 0;
      gameTime = 30;
      bullets = [];
      targets = [];
      isGameOver = false;
      
      // Update UI
      scoreDisplay.textContent = `Score: ${score}`;
      timerDisplay.textContent = `Time: ${gameTime}`;
      
      // Position player
      playerPosition = (gameContainer.offsetWidth / 2) - 30;
      player.style.left = `${playerPosition}px`;
      
      // Start game loops
      gameInterval = setInterval(updateGame, 20);
      targetGenerationInterval = setInterval(generateTarget, 600);
      
      // Start timer countdown
      timerInterval = setInterval(() => {
        gameTime--;
        if (gameTime <= 0) {
          gameTime = 0; // Ensure timer doesn't go below 0
          timerDisplay.textContent = `Time: ${gameTime}`;
          endGame(false);
          return;
        }
        
        // Play sound effects when time is running low
        if (gameTime <= 5) {
          // For 5 seconds and below, play the countdown every quarter second
          countdownFastSound.currentTime = 0;
          countdownFastSound.play();
          
          // Add quarter-second intervals for the last 5 seconds
          if (gameTime > 0) {
            setTimeout(() => {
              countdownFastSound.currentTime = 0;
              countdownFastSound.play();
            }, 250);
            
            setTimeout(() => {
              countdownFastSound.currentTime = 0;
              countdownFastSound.play();
            }, 500);
            
            setTimeout(() => {
              countdownFastSound.currentTime = 0;
              countdownFastSound.play();
            }, 750);
          }
        } else if (gameTime <= 10) {
          countdownFastSound.currentTime = 0;
          countdownFastSound.play();
          
          // Add half-second counter for the last 10 seconds
          if (gameTime > 0) {
            setTimeout(() => {
              countdownFastSound.currentTime = 0;
              countdownFastSound.play();
            }, 500);
          }
        } else {
          countdownSound.currentTime = 0;
          countdownSound.play();
        }
        
        timerDisplay.textContent = `Time: ${gameTime}`;
      }, 1000);
      
      // Setup keyboard controls
      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', handleKeyUp);
    }
    
    // Game key controls
    const keys = {
      left: false,
      right: false,
      space: false
    };
    
    function handleKeyDown(e) {
      if (e.key === 'ArrowLeft') keys.left = true;
      if (e.key === 'ArrowRight') keys.right = true;
      if (e.key === ' ' && !keys.space) {
        keys.space = true;
        fireBullet();
      }
    }
    
    function handleKeyUp(e) {
      if (e.key === 'ArrowLeft') keys.left = false;
      if (e.key === 'ArrowRight') keys.right = false;
      if (e.key === ' ') keys.space = false;
    }
    
    function updateGame() {
      if (isGameOver) return;
      
      // Move player
      const moveSpeed = 7;
      if (keys.left && playerPosition > 30) {
        playerPosition -= moveSpeed;
      }
      if (keys.right && playerPosition < gameContainer.offsetWidth - 30) {
        playerPosition += moveSpeed;
      }
      player.style.left = `${playerPosition}px`;
      
      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.y -= 7; // Move bullet up
        bullet.element.style.top = `${bullet.y}px`;
        
        // Remove bullets that are off screen
        if (bullet.y < 0) {
          gameContainer.removeChild(bullet.element);
          bullets.splice(i, 1);
        }
      }
      
      // Update targets
      for (let i = targets.length - 1; i >= 0; i--) {
        const target = targets[i];
        target.y += target.speed;
        target.element.style.top = `${target.y}px`;
        
        // Check if target hit bottom
        if (target.y > gameContainer.offsetHeight) {
          gameContainer.removeChild(target.element);
          targets.splice(i, 1);
          continue;
        }
        
        // Check for bullet collisions
        for (let j = bullets.length - 1; j >= 0; j--) {
          const bullet = bullets[j];
          if (checkCollision(bullet, target)) {
            // Create hit effect
            createHitEffect(target.x, target.y);
            
            // Update score
            score += 10;
            scoreDisplay.textContent = `Score: ${score}`;
            
            // Remove bullet and target
            gameContainer.removeChild(bullet.element);
            gameContainer.removeChild(target.element);
            bullets.splice(j, 1);
            targets.splice(i, 1);
            
            // Check win condition
            if (score >= 500) {
              endGame(true);
            }
            
            break;
          }
        }
      }
    }
    
    function fireBullet() {
      const bulletElement = document.createElement('div');
      bulletElement.className = 'bullet';
      
      const bulletX = playerPosition + 27; // Center of player
      const bulletY = gameContainer.offsetHeight - 100; // Just above player
      
      bulletElement.style.left = `${bulletX}px`;
      bulletElement.style.top = `${bulletY}px`;
      
      gameContainer.appendChild(bulletElement);
      
      bullets.push({
        element: bulletElement,
        x: bulletX,
        y: bulletY,
        width: 5,
        height: 15
      });
      laserSound.play();
    }
    
    function generateTarget() {
      if (isGameOver) return;
      
      const targetElement = document.createElement('div');
      targetElement.className = 'target';
      
      // Create pineapple pizza SVG
      const pizzaSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      pizzaSVG.setAttribute('width', '40');
      pizzaSVG.setAttribute('height', '40');
      pizzaSVG.setAttribute('viewBox', '0 0 40 40');
      
      // Pizza base (circle)
      const pizzaBase = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      pizzaBase.setAttribute('cx', '20');
      pizzaBase.setAttribute('cy', '20');
      pizzaBase.setAttribute('r', '18');
      pizzaBase.setAttribute('fill', '#E8B96F');
      pizzaBase.setAttribute('stroke', '#C87137');
      pizzaBase.setAttribute('stroke-width', '2');
      
      // Pizza sauce
      const pizzaSauce = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      pizzaSauce.setAttribute('cx', '20');
      pizzaSauce.setAttribute('cy', '20');
      pizzaSauce.setAttribute('r', '15');
      pizzaSauce.setAttribute('fill', '#D13B1C');
      
      // Pizza cheese
      const pizzaCheese = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      pizzaCheese.setAttribute('cx', '20');
      pizzaCheese.setAttribute('cy', '20');
      pizzaCheese.setAttribute('r', '14');
      pizzaCheese.setAttribute('fill', '#F7D358');
      
      // Pineapple pieces (triangles)
      const positions = [
        { x: 10, y: 15 },
        { x: 25, y: 10 },
        { x: 20, y: 25 },
        { x: 15, y: 30 },
        { x: 28, y: 22 }
      ];
      
      positions.forEach(pos => {
        const pineapple = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        pineapple.setAttribute('points', `${pos.x},${pos.y} ${pos.x + 5},${pos.y} ${pos.x + 2.5},${pos.y - 5}`);
        pineapple.setAttribute('fill', '#FFD700');
        pizzaSVG.appendChild(pineapple);
      });
      
      // Add all elements to SVG
      pizzaSVG.appendChild(pizzaBase);
      pizzaSVG.appendChild(pizzaSauce);
      pizzaSVG.appendChild(pizzaCheese);
      
      targetElement.appendChild(pizzaSVG);
      
      // Random position and speed
      const targetX = Math.random() * (gameContainer.offsetWidth - 40);
      const targetY = -40;
      const targetSpeed = 1 + Math.random() * 2;
      
      targetElement.style.left = `${targetX}px`;
      targetElement.style.top = `${targetY}px`;
      
      gameContainer.appendChild(targetElement);
      
      targets.push({
        element: targetElement,
        x: targetX,
        y: targetY,
        width: 40,
        height: 40,
        speed: targetSpeed
      });
    }
    
    function checkCollision(bullet, target) {
      return bullet.x < target.x + target.width &&
             bullet.x + bullet.width > target.x &&
             bullet.y < target.y + target.height &&
             bullet.y + bullet.height > target.y;
    }
    
    function createHitEffect(x, y) {
      const hitEffect = document.createElement('div');
      hitEffect.className = 'hit-effect';
      hitEffect.style.left = `${x}px`;
      hitEffect.style.top = `${y}px`;
      
      gameContainer.appendChild(hitEffect);
      
      // Remove hit effect after animation
      setTimeout(() => {
        if (gameContainer.contains(hitEffect)) {
          gameContainer.removeChild(hitEffect);
        }
      }, 300);
    }
    
    function endGame(isVictory) {
      isGameOver = true;
      
      // Clear intervals
      clearInterval(gameInterval);
      clearInterval(timerInterval);
      clearInterval(targetGenerationInterval);
      
      // Remove event listeners
      document.removeEventListener('keydown', handleKeyDown);
      document.removeEventListener('keyup', handleKeyUp);
      
      // Stop all sounds
      countdownSound.pause();
      countdownFastSound.pause();
      
      if (isVictory) {
        // Victory sequence
        celebration.style.display = 'flex';
        victorySound.play();
        
        // Create confetti
        for (let i = 0; i < 50; i++) {
          createConfetti();
        }
        
        // Show game completion after a delay
        setTimeout(() => {
          celebration.style.display = 'none';
          gameCompletion.style.display = 'block';
        }, 5000);
      } else {
        // Game over sequence
        gameOver.style.display = 'flex';
        eliminationSound.play();
      }
    }
    
    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = `${Math.random() * gameContainer.offsetWidth}px`;
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      confetti.style.animationDuration = `${3 + Math.random() * 2}s`;
      gameContainer.appendChild(confetti);
      
      // Remove confetti after animation
      setTimeout(() => {
        if (gameContainer.contains(confetti)) {
          gameContainer.removeChild(confetti);
        }
      }, 5000);
    }
    
    // Retry button functionality
    retryButton.addEventListener('click', () => {
      // Reset game elements
      gameOver.style.display = 'none';
      
      // Clear existing targets and bullets
      targets.forEach(target => {
        gameContainer.removeChild(target.element);
      });
      bullets.forEach(bullet => {
        gameContainer.removeChild(bullet.element);
      });
      
      // Restart game
      startGame();
    });
    
    // Home and next game buttons
    homeButton.addEventListener('click', () => {
      window.location.reload();
    });
    
    nextGameButton.addEventListener('click', () => {
      alert('Next game would load here!');
    });
  </script>
</body>
</html>